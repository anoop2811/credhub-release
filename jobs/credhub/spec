---
name: credhub
templates:
  # Lifecycle scripts
  pre-start.erb: bin/pre-start
  post-start.erb: bin/post-start
  drain.erb: bin/drain
  # Other scripts
  ctl: bin/ctl
  install_crt.sh: bin/install_crt.sh
  # Config
  application.properties.erb: config/application.properties
  log4j2.properties.erb: config/log4j2.properties
  encryption.conf.erb: config/encryption.conf

packages:
- openjdk_1.8.0
- lunaclient
- dsm-client
- credhub

properties:
  credhub.port:
    description: "Port for the CredHub server to listen on"
    default: 8844

  # Encryption properties
  # TODO: make this a collection
  credhub.encryption.provider:
    description: "HSM or dev_internal encryption" # TODO: mention DSM
    default: "hsm"
  credhub.encryption.dev_key:
    description: "AES key to be used for encryption during development"
    default: "D673ACD01DA091B08144FBC8C0B5F524"

  # TODO: make a collection for encryption keys
  # TODO: one key and one key ONLY may be active in encryption keys

  # HSM properties
  # TODO: these will be nested under providers
  credhub.encryption.hsm.host:
    description: "The IP address of the HSM"
  credhub.encryption.hsm.port:
    description: "The HSM port"
    default: 1792
  credhub.encryption.hsm.certificate:
    description: "The HSMs certificate"
  credhub.encryption.hsm.partition:
    description: "Name of the HSM partition"
  credhub.encryption.hsm.partition_password:
    description: "Password for the HSM partition"
  credhub.encryption.hsm.encryption_key_name:
    description: "The name of the key stored in HSM to be reference by CredHub server for encryption"
  credhub.encryption.hsm.client_certificate:
    description: "NTLS client certificate registered with HSM"
  credhub.encryption.hsm.client_key:
    description: "NTLS client private key matching the client_certificate"

  # DSM properties
  credhub.encryption.dsm.encryption_key_name:
    description: "The name of the key stored in DSM to be reference by CredHub server for encryption"
  credhub.encryption.dsm.servers:
    description: "The list of IP Addresses or the hostnames of the DSM's entry points"
    example:
      - host: 127.0.0.1
        user: vcap
        partition: partition_name
        ssh_private_key: |
          -----BEGIN RSA PRIVATE KEY-----
          ...
          -----END RSA PRIVATE KEY-----

# TLS configuration for the server
  credhub.tls:
    description: "Certificate and private key for TLS connection to CredHub API"
    type: certificate
    example: |
      certificate: |
        -----BEGIN CERTIFICATE-----
        ...
        -----END CERTIFICATE-----
      private_key: |
        -----BEGIN RSA PRIVATE KEY-----
        ...
        -----END RSA PRIVATE KEY-----

  # Data storage
  credhub.data_storage.type:
    description: "Database type, either in-memory (development only), mysql, or postgres, and there is no default"
  credhub.data_storage.username:
    description: "User name for credhub's database access"
  credhub.data_storage.password:
    description: "Password for credhub's database access"
  credhub.data_storage.host:
    description: "Host for credhub's database access"
  credhub.data_storage.port:
    description: "Port for credhub's database access"
  credhub.data_storage.database:
    description: "Name of database"
    default: "credhub"
  credhub.data_storage.require_tls:
    description: "If true, forbid insecure connections to MySQL. Does not apply to Postgres."
    default: true
  credhub.data_storage.tls_ca:
    description: "Certificate that database must supply when validation is required."

  # UAA
  credhub.user_management.uaa.url:
    description: "URL of UAA instance for client to contact"
  credhub.user_management.uaa.verification_key:
    description: "The public key for verifying tokens issued by the UAA instance"

  # Logging
  credhub.log_level:
    description: "Log level. Available levels are none, error, warn, info, debug"
    default: info
